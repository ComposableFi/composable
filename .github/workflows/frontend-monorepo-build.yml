name: Lint Check for Changed Paths
on:
  workflow_dispatch:
  pull_request:
    branches:
        - main
jobs:
  check-change:
    name: Check Changes
    runs-on:
      - self-hosted
      - Linux
      - X64
      - sre
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - id: check-changes
        uses: ./.github/actions/check-changes
        with:
          BASE: ${{ github.event.pull_request.base.sha }}
          HEAD: ${{ github.sha }}
          PREFIX: book/
          NESTING_LEVEL: 3
    outputs:
      matrix: ${{ steps.check-changes.outputs.paths }}
      changed: ${{ steps.check-changes.outputs.changed }}
  apply:
    name: Apply changes
    needs:
      - check-changes
    if: fromJson(needs.check-changes.outputs.changed)
    runs-on:
      - self-hosted
      - Linux
      - X64
      - sre
    steps:
      - uses: actions/checkout@v2
      # Create kubeconfig env var
      - name: Run Lint Code
        uses: stefanoeb/eslint-action@1.0.2 #npm lint github action
        working-directory: book/${{ paths.target }}
        run: npm run lint
