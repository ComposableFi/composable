name: Nix Commands PR comment.

on: pull_request

jobs:
  example_comment_pr:
    runs-on: ubuntu-latest
    name: An example job to comment a PR
    steps:
      - name: Checkout
        uses: actions/checkout@v3
                        
      - name: Comment PR
        uses: thollander/actions-comment-pull-request@v1
        with:
          message: |
            **Nix commands for this PR**

            Spin up a devnet:
            ```bash
            nix run "github:ComposableFi/composable/${{ github.event.pull_request.head.sha }}#devnet-up" -L
            ```

            Spin up a XCVM devnet
            ```bash
            nix run "github:ComposableFi/composable/${{ github.event.pull_request.head.sha }}#devnet-xcvm-up" -L
            ```

            Build our node:
            ```bash
            nix run "github:ComposableFi/composable/${{ github.event.pull_request.head.sha }}#composable-node" -L
            ```
            
            Are you on macOS, or do you not have [Nix](https://nixos.org/) installed? No worries, you can also run these commands in Docker like this:
            _(you only need to run the first command once on your machine)_
            ```bash
            docker volume create nix

            docker run --privileged --rm -v nix:/nix  -v /var/run/docker.sock:/var/run/docker.sock -it nixos/nix bash -c "nix run github:ComposableFi/composable/${{ github.event.pull_request.head.sha }}#devnet-up -L --option cores 8 --extra-experimental-features nix-command --extra-experimental-features flakes"
            ```
                
            Note that the initial build may take about one hour if it has not been cached by our CI yet. Once it is cached, builds should take about one minute. We currently do not provide build caches for ARM machines such as M1 Macs, but building on ARM is supported.
          comment_includes: 'Nix commands for this PR'
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}