name: "New runtime upgrade test"

on:
  push:
    branches:
      - new-runtime-upgrade

jobs:
  dali-client-release:
    runs-on:
      - self-hosted
      - linux
      - x64
      - sre
    steps:
#      - name: Clean up
#        continue-on-error: true
#        run: |
#          sudo chown -R $USER:$USER $GITHUB_WORKSPACE
#          docker system prune --force --all --volumes
#      - uses: actions/checkout@v2
#        with:
#          fetch-depth: 0
#
      - name: Set env
        run: |
          echo "RELEASE_VERSION=$(git tag --sort=committerdate | grep -E '^v[0-9]' | tail -1 )" >> $GITHUB_ENV

      - name: Print release version
        run: echo ${{ env.RELEASE_VERSION }}

      - name: Wget download composable_runtime.wasm
        run: |
          VERSION=v2.2.0
          echo "version: $VERSION"
          wget https://github.com/ComposableFi/composable/releases/download/${VERSION}/composable_runtime.wasm
            
          FILE=composable_runtime.wasm
          if [ -f "$FILE" ]; then
            echo "$FILE exists."
          else
            echo "$FILE does not exist."
            exit 1
          fi
#
#      - uses: borales/actions-yarn@v3.0.0
#      - name: Yarn installation
#        continue-on-error: false
#        run: yarn version
