name: "New runtime upgrade test"

on:
  push:
    branches:
      - new-runtime-upgrade

jobs:
  dali-client-release:
    runs-on:
      - self-hosted
      - linux
      - x64
      - sre
    steps:
#      - name: Clean up
#        continue-on-error: true
#        run: |
#          sudo chown -R $USER:$USER $GITHUB_WORKSPACE
#          docker system prune --force --all --volumes
#      - uses: actions/checkout@v2
#        with:
#          fetch-depth: 0
#
      - name: Set env
        run: |
          echo "RELEASE_VERSION=$(git tag --sort=committerdate | grep -E '^v[0-9]' | tail -1 )" >> $GITHUB_ENV

      - name: Print release version
        run: echo ${{ env.RELEASE_VERSION }}

      - name: Wget download composable_runtime.wasm
        run: |
          FILE_NAME=composable_runtime.wasm
          FILE_GITHUB_PATH=https://github.com/ComposableFi/composable/releases/download/${{ env.RELEASE_VERSION }}/$FILE_NAME
          wget $FILE_GITHUB_PATH
          
          if [ -f "$FILE_NAME" ]; then
            echo "$FILE_NAME was downloaded completely."
          else
            echo "Impossible to download {$FILE_GITHUB_PATH}."
            exit 1
          fi

      - name: Next step check
        run: echo "I'm here"
#
#      - uses: borales/actions-yarn@v3.0.0
#      - name: Yarn installation
#        continue-on-error: false
#        run: yarn version
