[env]
CARGO_MAKE_EXTEND_WORKSPACE_MAKEFILE = true


[tasks.fmt]
workspace = false
script = '''
cargo +nightly fmt
'''

[tasks.build]
workspace = false
args = ["build", "--release"]

[tasks.polkadot]
workspace = false
script = '''
if [ ! -d "../polkadot" ] ; then
    git clone -b v0.9.16 https://github.com/paritytech/polkadot ../polkadot
fi
cd ../polkadot && cargo build --release 
'''

[tasks.devnet]
workspace = false
dependencies = ["build", "polkadot"]
script = '''
cargo run --release -- --version
cd ../polkadot && cargo run --release -- --version && pwd && cd ../composable
cd scripts/polkadot-launch && yarn && yarn composable
'''

[tasks.run-local-integration-tests]
workspace=false
script='''
# we cannot use toolchain setting as different parts of codebase require different compiler
cargo +stable-x86_64-unknown-linux-gnu test --package local-integration-tests --features local-integration-tests
'''